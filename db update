sudo -u postgres psql -c "DROP DATABASE IF EXISTS alerts_db;"
sudo -u postgres psql -c "DROP DATABASE IF EXISTS applications;"
sudo -u postgres psql -c "DROP DATABASE IF EXISTS dashboard;"
sudo -u postgres psql -c "DROP DATABASE IF EXISTS deployment;"
sudo -u postgres psql -c "DROP DATABASE IF EXISTS devices;"
sudo -u postgres psql -c "DROP DATABASE IF EXISTS missions;"
sudo -u postgres psql -c "DROP DATABASE IF EXISTS traffic_management;"

sudo -u postgres psql -t -c "SELECT datname FROM pg_database WHERE datname NOT IN ('postgres','template0','template1');" | \
while read dbname; do
  [ -n "$dbname" ] && echo "Dropping $dbname..." && sudo -u postgres psql -c "DROP DATABASE \"$dbname\";";
done

sudo -u postgres psql -c "\du"

sudo -u postgres psql -c "CREATE ROLE admin WITH LOGIN PASSWORD 'password';"

sudo -u postgres psql -c "ALTER ROLE admin WITH SUPERUSER;"

sudo -u postgres psql -c "ALTER DATABASE alerts_db OWNER TO admin;"
sudo -u postgres psql -c "ALTER DATABASE applications OWNER TO admin;"
sudo -u postgres psql -c "ALTER DATABASE dashboard OWNER TO admin;"
sudo -u postgres psql -c "ALTER DATABASE deployment OWNER TO admin;"
sudo -u postgres psql -c "ALTER DATABASE devices OWNER TO admin;"
sudo -u postgres psql -c "ALTER DATABASE missions OWNER TO admin;"
sudo -u postgres psql -c "ALTER DATABASE traffic_management OWNER TO admin;"


#!/bin/bash
DBS=("alerts_db" "applications" "dashboard" "deployment" "devices" "missions" "traffic_management")

for db in "${DBS[@]}"; do
  echo "Configuring $db ..."
  sudo -u postgres psql -c "ALTER DATABASE $db OWNER TO admin;"
  sudo -u postgres psql -d "$db" -c "ALTER SCHEMA public OWNER TO admin;"
  sudo -u postgres psql -d "$db" -c "GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO admin;"
  sudo -u postgres psql -d "$db" -c "GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO admin;"
  sudo -u postgres psql -d "$db" -c "ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO admin;"
done


chmod +x grant_admin_access.sh
./grant_admin_access.sh



